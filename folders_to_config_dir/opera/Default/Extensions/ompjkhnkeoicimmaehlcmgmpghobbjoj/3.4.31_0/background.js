/*! For license information please see background.js.LICENSE.txt */
(()=>{var e={9416:(e,t,r)=>{"use strict";t.browser=r(3150)},3150:function(e,t){var r,n;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,r=function(e){"use strict";if("undefined"==typeof browser||Object.getPrototypeOf(browser)!==Object.prototype){const t="The message port closed before a response was received.",r="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",n=e=>{const n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(n).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class a extends WeakMap{constructor(e,t=void 0){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const o=(t,r)=>(...n)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):r.singleCallbackArg||n.length<=1&&!1!==r.singleCallbackArg?t.resolve(n[0]):t.resolve(n)},s=e=>1==e?"argument":"arguments",i=(e,t,r)=>new Proxy(t,{apply:(t,n,a)=>r.call(n,e,...a)});let u=Function.call.bind(Object.prototype.hasOwnProperty);const c=(e,t={},r={})=>{let n=Object.create(null),a={has:(t,r)=>r in e||r in n,get(a,l,h){if(l in n)return n[l];if(!(l in e))return;let d=e[l];if("function"==typeof d)if("function"==typeof t[l])d=i(e,e[l],t[l]);else if(u(r,l)){let t=((e,t)=>function(r,...n){if(n.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${s(t.minArgs)} for ${e}(), got ${n.length}`);if(n.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${s(t.maxArgs)} for ${e}(), got ${n.length}`);return new Promise(((a,s)=>{if(t.fallbackToNoCallback)try{r[e](...n,o({resolve:a,reject:s},t))}catch(o){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,o),r[e](...n),t.fallbackToNoCallback=!1,t.noCallback=!0,a()}else t.noCallback?(r[e](...n),a()):r[e](...n,o({resolve:a,reject:s},t))}))})(l,r[l]);d=i(e,e[l],t)}else d=d.bind(e);else if("object"==typeof d&&null!==d&&(u(t,l)||u(r,l)))d=c(d,t[l],r[l]);else{if(!u(r,"*"))return Object.defineProperty(n,l,{configurable:!0,enumerable:!0,get:()=>e[l],set(t){e[l]=t}}),d;d=c(d,t[l],r["*"])}return n[l]=d,d},set:(t,r,a,o)=>(r in n?n[r]=a:e[r]=a,!0),defineProperty:(e,t,r)=>Reflect.defineProperty(n,t,r),deleteProperty:(e,t)=>Reflect.deleteProperty(n,t)},l=Object.create(e);return new Proxy(l,a)},l=e=>({addListener(t,r,...n){t.addListener(e.get(r),...n)},hasListener:(t,r)=>t.hasListener(e.get(r)),removeListener(t,r){t.removeListener(e.get(r))}}),h=new a((e=>"function"!=typeof e?e:function(t){const r=c(t,{},{getContent:{minArgs:0,maxArgs:0}});e(r)}));let d=!1;const f=new a((e=>"function"!=typeof e?e:function(t,n,a){let o,s,i=!1,u=new Promise((e=>{o=function(t){d||(console.warn(r,(new Error).stack),d=!0),i=!0,e(t)}}));try{s=e(t,n,o)}catch(e){s=Promise.reject(e)}const c=!0!==s&&((l=s)&&"object"==typeof l&&"function"==typeof l.then);var l;if(!0!==s&&!c&&!i)return!1;return(c?s:u).then((e=>{a(e)}),(e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",a({__mozWebExtensionPolyfillReject__:!0,message:t})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)})),!0})),g=({reject:r,resolve:n},a)=>{e.runtime.lastError?e.runtime.lastError.message===t?n():r(new Error(e.runtime.lastError.message)):a&&a.__mozWebExtensionPolyfillReject__?r(new Error(a.message)):n(a)},p=(e,t,r,...n)=>{if(n.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${s(t.minArgs)} for ${e}(), got ${n.length}`);if(n.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${s(t.maxArgs)} for ${e}(), got ${n.length}`);return new Promise(((e,t)=>{const a=g.bind(null,{resolve:e,reject:t});n.push(a),r.sendMessage(...n)}))},m={devtools:{network:{onRequestFinished:l(h)}},runtime:{onMessage:l(f),onMessageExternal:l(f),sendMessage:p.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:p.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},v={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":v},services:{"*":v},websites:{"*":v}},c(e,m,n)};if("object"!=typeof chrome||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");e.exports=n(chrome)}else e.exports=browser},void 0===(n=r.apply(t,[e]))||(e.exports=n)},7061:(e,t,r)=>{var n=r(8698).default;function a(){"use strict";e.exports=a=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},r=Object.prototype,o=r.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof p?t:p,o=Object.create(a.prototype),i=new P(n||[]);return s(o,"_invoke",{value:_(e,r,i)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var g={};function p(){}function m(){}function v(){}var A={};h(A,u,(function(){return this}));var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==r&&o.call(y,u)&&(A=y);var w=v.prototype=p.prototype=Object.create(A);function x(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(a,s,i,u){var c=f(e[a],e,s);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==n(h)&&o.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,i,u)}),(function(e){r("throw",e,i,u)})):t.resolve(h).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,u)}))}u(c.arg)}var a;s(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,a){r(e,n,t,a)}))}return a=a?a.then(o,o):o()}})}function _(e,t,r){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return{value:void 0,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var i=E(s,r);if(i){if(i===g)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var a=f(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,g;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,g):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function I(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(o.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:k}}function k(){return{value:void 0,done:!0}}return m.prototype=v,s(w,"constructor",{value:v,configurable:!0}),s(v,"constructor",{value:m,configurable:!0}),m.displayName=h(v,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,h(e,l,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},x(O.prototype),h(O.prototype,c,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var s=new O(d(e,r,n,a),o);return t.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},x(w),h(w,l,"Generator"),h(w,u,(function(){return this})),h(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var i=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(i&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(i){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;T(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),g}},t}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},8698:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4687:(e,t,r)=>{var n=r(7061)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(e,t,r,n,a,o,s){try{var i=e[o](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,a)}function t(t){return function(){var r=this,n=arguments;return new Promise((function(a,o){var s=t.apply(r,n);function i(t){e(s,a,o,i,u,"next",t)}function u(t){e(s,a,o,i,u,"throw",t)}i(void 0)}))}}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,"string");if("object"!==n(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o=r(4687),s=r.n(o),i=r(9416),u=!1;i.browser.storage.local.get().then((function(e){u=e.staging}));var c=function(){return u},l=function(){return u?"https://cashback.op-test.net/":"https://cashback.opera.com/"};function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,s,i=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);u=!0);}catch(e){c=!0,a=e}finally{try{if(!u&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw a}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var f,g,p=function(e){return e.Chrome="Chrome",e.Opera="Opera",e.OperaGX="OperaGX",e.Safari="Safari",e.Firefox="Firefox",e.Other="Other",e}({}),m=function(e){return e.ACTIVATION="ACTIVATION",e.NOT_PARTNER="NOT_PARTNER",e.COMPETITOR="COMPETITOR",e.CHECKOUT="CHECKOUT",e.WELCOME="WELCOME",e.PROMO="PROMO",e.MAIN_NON_AUTOMATIC="MAIN_NON_AUTOMATIC",e}({}),v=function(e){return e.DONT_OPEN_AGAIN="dont_open_again",e.DONT_OPEN_AGAIN_TODAY="dont_open_again_today",e.DONT_OPEN_ALL_SHOPS="dont_open_all_shops",e.DISABLE_SAVING_GOALS="disable_saving_goals",e}({}),A=function(e){return e.ACTIVATE_CASHBACK="ACTIVATE_CASHBACK",e.FETCH_OFFER_DATA="FETCH_OFFER_DATA",e.OFFER_DATA="OFFER_DATA",e.SEND_STATS="SEND_STATS",e.GET_SETTINGS_FOR_PAGE="GET_SETTINGS_FOR_PAGE",e.SETTINGS_FOR_PAGE="SETTINGS_FOR_PAGE",e.SET_SETTINGS_FOR_PAGE="SET_SETTINGS_FOR_PAGE",e.GET_VERSION="GET_VERSION",e.VERSION="VERSION",e.IS_LOGGED="IS_LOGGED",e.SET_LANGUAGE="SET_LANGUAGE",e.SET_STAGING="SET_STAGING",e.SET_SAVING_GOAL="SET_SAVING_GOAL",e.GET_SAVING_GOAL_DATA="GET_SAVING_GOAL_DATA",e.SAVING_GOAL_DATA="SAVING_GOAL_DATA",e.GET_SAVING_GOAL_BALANCE="GET_SAVING_GOAL_BALANCE",e.SAVING_GOAL_BALANCE="SAVING_GOAL_BALANCE",e.GET_SAVING_GOAL_TEMPLATES="GET_SAVING_GOAL_TEMPLATES",e.SAVING_GOAL_TEMPLATES="SAVING_GOAL_TEMPLATES",e.UPDATE_SAVING_GOAL="UPDATE_SAVING_GOAL",e.INCREASE_SAVING_GOAL_COUNTER="INCREASE_SAVING_GOAL_COUNTER",e.RESET_SAVING_GOAL_COUNTER="RESET_SAVING_GOAL_COUNTER",e.MARK_PENDING_VIEW_SECTION="MARK_PENDING_VIEW_SECTION",e.RESET_STORAGE="RESET_STORAGE",e}({});function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var w,x=!1,O=!1,_=function(){if(!O)throw"Using uninitialised getBrowser";return w||(w=function(){var e=window.chrome,t=window.navigator.userAgent.toLowerCase(),r=void 0!==window.opr,n=t.indexOf("firefox")>-1,a=t.indexOf("safari")>-1,o=t.indexOf("edge")>-1;if(t.match("crios"));else{if(null!=e&&!1===r&&!1===o)return p.Chrome;if(r)return x?p.OperaGX:p.Opera;if(n)return p.Firefox;if(a)return p.Safari}return p.Other}())},E=function(e,t,r){var n=new URL(t).hostname.split(".").slice(-e.split(".").length).join(".")===e;return r.forEach((function(e){return n=n&&-1===t.indexOf(e)})),n},S=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=new URL(e.url);if(!P){var o=a.search.substr(1).split("&"),s=/cjevent/i,i=!1;if(o.forEach((function(e){var t=d(e.split("="),2),r=t[0],n=t[1];(s.test(r)||s.test(n))&&(i=!0)})),i&&!e.isActivated)return!1}if("ebay"===function(e){return e.split(".").splice(-2,1)[0].toLowerCase()}(a.host)){var u=!1,c=!1;if([e.url].concat(e.redirs).forEach((function(e){new URL(e).search.substr(1).split("&").forEach((function(e){var t=d(e.split("="),2),r=t[0],n=t[1];["mkevt","mkcid","campid"].includes(r)&&(c=!0),"campid"===r&&["5338944028","5338944027","5338930307","5338838092","5338837356","5338787428"].includes(n)&&(u=!0)}))})),c&&!u)return!1}if(_()===p.OperaGX){if(e.popup_type===m.NOT_PARTNER)return!1;if(-1===["GB","ES"].indexOf(null==t?void 0:t.toUpperCase())&&!e.isUserLoggedBefore)return!1}return n||Date.now()>(e.activated&&e.activated.closed_till||0)&&!(e.settingsForPage&&(e.settingsForPage[v.DONT_OPEN_ALL_SHOPS]||e.settingsForPage[v.DONT_OPEN_AGAIN]||e.settingsForPage[v.DONT_OPEN_AGAIN_TODAY]&&e.settingsForPage[v.DONT_OPEN_AGAIN_TODAY]>Date.now()))&&(P?!e.offer.disableAssistant:e.isActivated&&e.offer.showPopupCbActivated||!e.isActivated&&(null===(r=e.offer)||void 0===r?void 0:r.showPopupActivateCb))},T=window.opr,P=!(null===(f=window.opr)||void 0===f||null===(g=f.cashbackPrivate)||void 0===g||!g.onCashbackButtonPressed),I=T&&chrome.runtime.getManifest().name.toLowerCase().indexOf("assistant")>-1&&!P,k=(new URL(window.location.toString()).searchParams.get("id"),function(e){if("allegro.pl"===e.host){var t=e.searchParams.get("utm_source"),r=e.searchParams.get("utm_campaign");return!!(t&&"ctr_b"!==t||r&&"55441244-6905-4da3-be17-24d7f3e0271c"!==r)}return!1}),C=function(){return window.matchMedia("(prefers-color-scheme: dark)").matches},L=function(){return i.browser.runtime.getManifest().version},N=function(){var e=t(s().mark((function e(r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.browser.tabs.query(y({active:!0},r?{windowId:Number(r)}:{})).then(function(){var e=t(s().mark((function e(t){var n,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t[0].workspaceId,!P||!a){e.next=8;break}return e.next=4,new Promise((function(e){return opr.workspacesPrivate.getActiveWorkspaceId(Number(r),e)}));case 4:o=e.sent,n=t.find((function(e){return e.workspaceId===o.toString()&&e.windowId===r})),e.next=9;break;case 8:n=t[0];case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(e){try{return new URL(e)}catch(t){return console.error("Cannot create URL - provided string: ".concat(e)),null}},R=function(e,t){for(var r=null==e?void 0:e.map((function(e){var t;return null===(t=G(e.url))||void 0===t?void 0:t.host})),n=t.host.split("."),a=n.length;a>1;a--)if(r.includes(n.slice(-a).join(".")))return!0;return!1},D=function(e,t){for(var r=Object.fromEntries(null==e?void 0:e.map((function(e){var t;return[null===(t=G(e.url))||void 0===t?void 0:t.host,e.merchantIds]}))),n=t.host.split("."),a=n.length;a>1;a--){var o=n.slice(-a).join(".");if(r[o])return r[o]}return[]};const M="undefined"==typeof window||"Deno"in window;function j(){}function F(e,t,r){return z(e)?"function"==typeof t?{...r,queryKey:e,queryFn:t}:{...t,queryKey:e}:e}function q(e,t,r){return z(e)?[{...t,queryKey:e},r]:[e||{},t]}function U(e,t){const{type:r="all",exact:n,fetchStatus:a,predicate:o,queryKey:s,stale:i}=e;if(z(s))if(n){if(t.queryHash!==V(s,t.options))return!1}else if(!Q(t.queryKey,s))return!1;if("all"!==r){const e=t.isActive();if("active"===r&&!e)return!1;if("inactive"===r&&e)return!1}return!("boolean"==typeof i&&t.isStale()!==i||void 0!==a&&a!==t.state.fetchStatus||o&&!o(t))}function B(e,t){const{exact:r,fetching:n,predicate:a,mutationKey:o}=e;if(z(o)){if(!t.options.mutationKey)return!1;if(r){if(K(t.options.mutationKey)!==K(o))return!1}else if(!Q(t.options.mutationKey,o))return!1}return!("boolean"==typeof n&&"loading"===t.state.status!==n||a&&!a(t))}function V(e,t){return((null==t?void 0:t.queryKeyHashFn)||K)(e)}function K(e){return JSON.stringify(e,((e,t)=>Y(t)?Object.keys(t).sort().reduce(((e,r)=>(e[r]=t[r],e)),{}):t))}function Q(e,t){return H(e,t)}function H(e,t){return e===t||typeof e==typeof t&&!(!e||!t||"object"!=typeof e||"object"!=typeof t)&&!Object.keys(t).some((r=>!H(e[r],t[r])))}function W(e,t){if(e===t)return e;const r=$(e)&&$(t);if(r||Y(e)&&Y(t)){const n=r?e.length:Object.keys(e).length,a=r?t:Object.keys(t),o=a.length,s=r?[]:{};let i=0;for(let n=0;n<o;n++){const o=r?n:a[n];s[o]=W(e[o],t[o]),s[o]===e[o]&&i++}return n===o&&i===n?e:s}return t}function $(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function Y(e){if(!X(e))return!1;const t=e.constructor;if(void 0===t)return!0;const r=t.prototype;return!!X(r)&&!!r.hasOwnProperty("isPrototypeOf")}function X(e){return"[object Object]"===Object.prototype.toString.call(e)}function z(e){return Array.isArray(e)}function J(e){return new Promise((t=>{setTimeout(t,e)}))}function Z(e){J(0).then(e)}function ee(e,t,r){return null!=r.isDataEqual&&r.isDataEqual(e,t)?e:"function"==typeof r.structuralSharing?r.structuralSharing(e,t):!1!==r.structuralSharing?W(e,t):t}const te=console,re=function(){let e=[],t=0,r=e=>{e()},n=e=>{e()};const a=n=>{t?e.push(n):Z((()=>{r(n)}))};return{batch:a=>{let o;t++;try{o=a()}finally{t--,t||(()=>{const t=e;e=[],t.length&&Z((()=>{n((()=>{t.forEach((e=>{r(e)}))}))}))})()}return o},batchCalls:e=>(...t)=>{a((()=>{e(...t)}))},schedule:a,setNotifyFunction:e=>{r=e},setBatchNotifyFunction:e=>{n=e}}}();class ne{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){const t={listener:e};return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}}const ae=new class extends ne{constructor(){super(),this.setup=e=>{if(!M&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),window.addEventListener("focus",t,!1),()=>{window.removeEventListener("visibilitychange",t),window.removeEventListener("focus",t)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){var e;this.hasListeners()||(null==(e=this.cleanup)||e.call(this),this.cleanup=void 0)}setEventListener(e){var t;this.setup=e,null==(t=this.cleanup)||t.call(this),this.cleanup=e((e=>{"boolean"==typeof e?this.setFocused(e):this.onFocus()}))}setFocused(e){this.focused!==e&&(this.focused=e,this.onFocus())}onFocus(){this.listeners.forEach((({listener:e})=>{e()}))}isFocused(){return"boolean"==typeof this.focused?this.focused:"undefined"==typeof document||[void 0,"visible","prerender"].includes(document.visibilityState)}},oe=["online","offline"],se=new class extends ne{constructor(){super(),this.setup=e=>{if(!M&&window.addEventListener){const t=()=>e();return oe.forEach((e=>{window.addEventListener(e,t,!1)})),()=>{oe.forEach((e=>{window.removeEventListener(e,t)}))}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){var e;this.hasListeners()||(null==(e=this.cleanup)||e.call(this),this.cleanup=void 0)}setEventListener(e){var t;this.setup=e,null==(t=this.cleanup)||t.call(this),this.cleanup=e((e=>{"boolean"==typeof e?this.setOnline(e):this.onOnline()}))}setOnline(e){this.online!==e&&(this.online=e,this.onOnline())}onOnline(){this.listeners.forEach((({listener:e})=>{e()}))}isOnline(){return"boolean"==typeof this.online?this.online:"undefined"==typeof navigator||void 0===navigator.onLine||navigator.onLine}};function ie(e){return Math.min(1e3*2**e,3e4)}function ue(e){return"online"!==(null!=e?e:"online")||se.isOnline()}class ce{constructor(e){this.revert=null==e?void 0:e.revert,this.silent=null==e?void 0:e.silent}}function le(e){return e instanceof ce}function he(e){let t,r,n,a=!1,o=0,s=!1;const i=new Promise(((e,t)=>{r=e,n=t})),u=()=>!ae.isFocused()||"always"!==e.networkMode&&!se.isOnline(),c=n=>{s||(s=!0,null==e.onSuccess||e.onSuccess(n),null==t||t(),r(n))},l=r=>{s||(s=!0,null==e.onError||e.onError(r),null==t||t(),n(r))},h=()=>new Promise((r=>{t=e=>{const t=s||!u();return t&&r(e),t},null==e.onPause||e.onPause()})).then((()=>{t=void 0,s||null==e.onContinue||e.onContinue()})),d=()=>{if(s)return;let t;try{t=e.fn()}catch(e){t=Promise.reject(e)}Promise.resolve(t).then(c).catch((t=>{var r,n;if(s)return;const i=null!=(r=e.retry)?r:3,c=null!=(n=e.retryDelay)?n:ie,f="function"==typeof c?c(o,t):c,g=!0===i||"number"==typeof i&&o<i||"function"==typeof i&&i(o,t);!a&&g?(o++,null==e.onFail||e.onFail(o,t),J(f).then((()=>{if(u())return h()})).then((()=>{a?l(t):d()}))):l(t)}))};return ue(e.networkMode)?d():h().then(d),{promise:i,cancel:t=>{s||(l(new ce(t)),null==e.abort||e.abort())},continue:()=>(null==t?void 0:t())?i:Promise.resolve(),cancelRetry:()=>{a=!0},continueRetry:()=>{a=!1}}}class de{destroy(){this.clearGcTimeout()}scheduleGc(){var e;this.clearGcTimeout(),"number"==typeof(e=this.cacheTime)&&e>=0&&e!==1/0&&(this.gcTimeout=setTimeout((()=>{this.optionalRemove()}),this.cacheTime))}updateCacheTime(e){this.cacheTime=Math.max(this.cacheTime||0,null!=e?e:M?1/0:3e5)}clearGcTimeout(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)}}class fe extends de{constructor(e){super(),this.abortSignalConsumed=!1,this.defaultOptions=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.cache=e.cache,this.logger=e.logger||te,this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.initialState=e.state||function(e){const t="function"==typeof e.initialData?e.initialData():e.initialData,r=void 0!==t,n=r?"function"==typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?null!=n?n:Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"loading",fetchStatus:"idle"}}(this.options),this.state=this.initialState,this.scheduleGc()}get meta(){return this.options.meta}setOptions(e){this.options={...this.defaultOptions,...e},this.updateCacheTime(this.options.cacheTime)}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||this.cache.remove(this)}setData(e,t){const r=ee(this.state.data,e,this.options);return this.dispatch({data:r,type:"success",dataUpdatedAt:null==t?void 0:t.updatedAt,manual:null==t?void 0:t.manual}),r}setState(e,t){this.dispatch({type:"setState",state:e,setStateOptions:t})}cancel(e){var t;const r=this.promise;return null==(t=this.retryer)||t.cancel(e),r?r.then(j).catch(j):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.initialState)}isActive(){return this.observers.some((e=>!1!==e.options.enabled))}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some((e=>e.getCurrentResult().isStale))}isStaleByTime(e=0){return this.state.isInvalidated||!this.state.dataUpdatedAt||!function(e,t){return Math.max(e+(t||0)-Date.now(),0)}(this.state.dataUpdatedAt,e)}onFocus(){var e;const t=this.observers.find((e=>e.shouldFetchOnWindowFocus()));t&&t.refetch({cancelRefetch:!1}),null==(e=this.retryer)||e.continue()}onOnline(){var e;const t=this.observers.find((e=>e.shouldFetchOnReconnect()));t&&t.refetch({cancelRefetch:!1}),null==(e=this.retryer)||e.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter((t=>t!==e)),this.observers.length||(this.retryer&&(this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.scheduleGc()),this.cache.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.dispatch({type:"invalidate"})}fetch(e,t){var r,n;if("idle"!==this.state.fetchStatus)if(this.state.dataUpdatedAt&&null!=t&&t.cancelRefetch)this.cancel({silent:!0});else if(this.promise){var a;return null==(a=this.retryer)||a.continueRetry(),this.promise}if(e&&this.setOptions(e),!this.options.queryFn){const e=this.observers.find((e=>e.options.queryFn));e&&this.setOptions(e.options)}const o=function(){if("function"==typeof AbortController)return new AbortController}(),s={queryKey:this.queryKey,pageParam:void 0,meta:this.meta},i=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>{if(o)return this.abortSignalConsumed=!0,o.signal}})};i(s);const u={fetchOptions:t,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:()=>this.options.queryFn?(this.abortSignalConsumed=!1,this.options.queryFn(s)):Promise.reject("Missing queryFn for queryKey '"+this.options.queryHash+"'")};var c;i(u),null==(r=this.options.behavior)||r.onFetch(u),this.revertState=this.state,("idle"===this.state.fetchStatus||this.state.fetchMeta!==(null==(n=u.fetchOptions)?void 0:n.meta))&&this.dispatch({type:"fetch",meta:null==(c=u.fetchOptions)?void 0:c.meta});const l=e=>{var t,r,n,a;le(e)&&e.silent||this.dispatch({type:"error",error:e}),le(e)||(null==(t=(r=this.cache.config).onError)||t.call(r,e,this),null==(n=(a=this.cache.config).onSettled)||n.call(a,this.state.data,e,this)),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return this.retryer=he({fn:u.fetchFn,abort:null==o?void 0:o.abort.bind(o),onSuccess:e=>{var t,r,n,a;void 0!==e?(this.setData(e),null==(t=(r=this.cache.config).onSuccess)||t.call(r,e,this),null==(n=(a=this.cache.config).onSettled)||n.call(a,e,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1):l(new Error(this.queryHash+" data is undefined"))},onError:l,onFail:(e,t)=>{this.dispatch({type:"failed",failureCount:e,error:t})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode}),this.promise=this.retryer.promise,this.promise}dispatch(e){this.state=(t=>{var r,n;switch(e.type){case"failed":return{...t,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null!=(r=e.meta)?r:null,fetchStatus:ue(this.options.networkMode)?"fetching":"paused",...!t.dataUpdatedAt&&{error:null,status:"loading"}};case"success":return{...t,data:e.data,dataUpdateCount:t.dataUpdateCount+1,dataUpdatedAt:null!=(n=e.dataUpdatedAt)?n:Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const a=e.error;return le(a)&&a.revert&&this.revertState?{...this.revertState,fetchStatus:"idle"}:{...t,error:a,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...e.state}}})(this.state),re.batch((()=>{this.observers.forEach((t=>{t.onQueryUpdate(e)})),this.cache.notify({query:this,type:"updated",action:e})}))}}class ge extends ne{constructor(e){super(),this.config=e||{},this.queries=[],this.queriesMap={}}build(e,t,r){var n;const a=t.queryKey,o=null!=(n=t.queryHash)?n:V(a,t);let s=this.get(o);return s||(s=new fe({cache:this,logger:e.getLogger(),queryKey:a,queryHash:o,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(a)}),this.add(s)),s}add(e){this.queriesMap[e.queryHash]||(this.queriesMap[e.queryHash]=e,this.queries.push(e),this.notify({type:"added",query:e}))}remove(e){const t=this.queriesMap[e.queryHash];t&&(e.destroy(),this.queries=this.queries.filter((t=>t!==e)),t===e&&delete this.queriesMap[e.queryHash],this.notify({type:"removed",query:e}))}clear(){re.batch((()=>{this.queries.forEach((e=>{this.remove(e)}))}))}get(e){return this.queriesMap[e]}getAll(){return this.queries}find(e,t){const[r]=q(e,t);return void 0===r.exact&&(r.exact=!0),this.queries.find((e=>U(r,e)))}findAll(e,t){const[r]=q(e,t);return Object.keys(r).length>0?this.queries.filter((e=>U(r,e))):this.queries}notify(e){re.batch((()=>{this.listeners.forEach((({listener:t})=>{t(e)}))}))}onFocus(){re.batch((()=>{this.queries.forEach((e=>{e.onFocus()}))}))}onOnline(){re.batch((()=>{this.queries.forEach((e=>{e.onOnline()}))}))}}class pe extends de{constructor(e){super(),this.defaultOptions=e.defaultOptions,this.mutationId=e.mutationId,this.mutationCache=e.mutationCache,this.logger=e.logger||te,this.observers=[],this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options={...this.defaultOptions,...e},this.updateCacheTime(this.options.cacheTime)}get meta(){return this.options.meta}setState(e){this.dispatch({type:"setState",state:e})}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.mutationCache.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.observers=this.observers.filter((t=>t!==e)),this.scheduleGc(),this.mutationCache.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.observers.length||("loading"===this.state.status?this.scheduleGc():this.mutationCache.remove(this))}continue(){var e,t;return null!=(e=null==(t=this.retryer)?void 0:t.continue())?e:this.execute()}async execute(){const e=()=>{var e;return this.retryer=he({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:(e,t)=>{this.dispatch({type:"failed",failureCount:e,error:t})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:null!=(e=this.options.retry)?e:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode}),this.retryer.promise},t="loading"===this.state.status;try{var r,n,a,o,s,i,u,c;if(!t){var l,h,d,f;this.dispatch({type:"loading",variables:this.options.variables}),await(null==(l=(h=this.mutationCache.config).onMutate)?void 0:l.call(h,this.state.variables,this));const e=await(null==(d=(f=this.options).onMutate)?void 0:d.call(f,this.state.variables));e!==this.state.context&&this.dispatch({type:"loading",context:e,variables:this.state.variables})}const g=await e();return await(null==(r=(n=this.mutationCache.config).onSuccess)?void 0:r.call(n,g,this.state.variables,this.state.context,this)),await(null==(a=(o=this.options).onSuccess)?void 0:a.call(o,g,this.state.variables,this.state.context)),await(null==(s=(i=this.mutationCache.config).onSettled)?void 0:s.call(i,g,null,this.state.variables,this.state.context,this)),await(null==(u=(c=this.options).onSettled)?void 0:u.call(c,g,null,this.state.variables,this.state.context)),this.dispatch({type:"success",data:g}),g}catch(e){try{var g,p,m,v,A,b,y,w;throw await(null==(g=(p=this.mutationCache.config).onError)?void 0:g.call(p,e,this.state.variables,this.state.context,this)),await(null==(m=(v=this.options).onError)?void 0:m.call(v,e,this.state.variables,this.state.context)),await(null==(A=(b=this.mutationCache.config).onSettled)?void 0:A.call(b,void 0,e,this.state.variables,this.state.context,this)),await(null==(y=(w=this.options).onSettled)?void 0:y.call(w,void 0,e,this.state.variables,this.state.context)),e}finally{this.dispatch({type:"error",error:e})}}}dispatch(e){this.state=(t=>{switch(e.type){case"failed":return{...t,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"loading":return{...t,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!ue(this.options.networkMode),status:"loading",variables:e.variables};case"success":return{...t,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"};case"setState":return{...t,...e.state}}})(this.state),re.batch((()=>{this.observers.forEach((t=>{t.onMutationUpdate(e)})),this.mutationCache.notify({mutation:this,type:"updated",action:e})}))}}class me extends ne{constructor(e){super(),this.config=e||{},this.mutations=[],this.mutationId=0}build(e,t,r){const n=new pe({mutationCache:this,logger:e.getLogger(),mutationId:++this.mutationId,options:e.defaultMutationOptions(t),state:r,defaultOptions:t.mutationKey?e.getMutationDefaults(t.mutationKey):void 0});return this.add(n),n}add(e){this.mutations.push(e),this.notify({type:"added",mutation:e})}remove(e){this.mutations=this.mutations.filter((t=>t!==e)),this.notify({type:"removed",mutation:e})}clear(){re.batch((()=>{this.mutations.forEach((e=>{this.remove(e)}))}))}getAll(){return this.mutations}find(e){return void 0===e.exact&&(e.exact=!0),this.mutations.find((t=>B(e,t)))}findAll(e){return this.mutations.filter((t=>B(e,t)))}notify(e){re.batch((()=>{this.listeners.forEach((({listener:t})=>{t(e)}))}))}resumePausedMutations(){var e;return this.resuming=(null!=(e=this.resuming)?e:Promise.resolve()).then((()=>{const e=this.mutations.filter((e=>e.state.isPaused));return re.batch((()=>e.reduce(((e,t)=>e.then((()=>t.continue().catch(j)))),Promise.resolve())))})).then((()=>{this.resuming=void 0})),this.resuming}}function ve(e,t){return null==e.getNextPageParam?void 0:e.getNextPageParam(t[t.length-1],t)}var Ae,be=new class{constructor(e={}){this.queryCache=e.queryCache||new ge,this.mutationCache=e.mutationCache||new me,this.logger=e.logger||te,this.defaultOptions=e.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[],this.mountCount=0}mount(){this.mountCount++,1===this.mountCount&&(this.unsubscribeFocus=ae.subscribe((()=>{ae.isFocused()&&(this.resumePausedMutations(),this.queryCache.onFocus())})),this.unsubscribeOnline=se.subscribe((()=>{se.isOnline()&&(this.resumePausedMutations(),this.queryCache.onOnline())})))}unmount(){var e,t;this.mountCount--,0===this.mountCount&&(null==(e=this.unsubscribeFocus)||e.call(this),this.unsubscribeFocus=void 0,null==(t=this.unsubscribeOnline)||t.call(this),this.unsubscribeOnline=void 0)}isFetching(e,t){const[r]=q(e,t);return r.fetchStatus="fetching",this.queryCache.findAll(r).length}isMutating(e){return this.mutationCache.findAll({...e,fetching:!0}).length}getQueryData(e,t){var r;return null==(r=this.queryCache.find(e,t))?void 0:r.state.data}ensureQueryData(e,t,r){const n=F(e,t,r),a=this.getQueryData(n.queryKey);return a?Promise.resolve(a):this.fetchQuery(n)}getQueriesData(e){return this.getQueryCache().findAll(e).map((({queryKey:e,state:t})=>[e,t.data]))}setQueryData(e,t,r){const n=this.queryCache.find(e),a=function(e,t){return"function"==typeof e?e(t):e}(t,null==n?void 0:n.state.data);if(void 0===a)return;const o=F(e),s=this.defaultQueryOptions(o);return this.queryCache.build(this,s).setData(a,{...r,manual:!0})}setQueriesData(e,t,r){return re.batch((()=>this.getQueryCache().findAll(e).map((({queryKey:e})=>[e,this.setQueryData(e,t,r)]))))}getQueryState(e,t){var r;return null==(r=this.queryCache.find(e,t))?void 0:r.state}removeQueries(e,t){const[r]=q(e,t),n=this.queryCache;re.batch((()=>{n.findAll(r).forEach((e=>{n.remove(e)}))}))}resetQueries(e,t,r){const[n,a]=q(e,t,r),o=this.queryCache,s={type:"active",...n};return re.batch((()=>(o.findAll(n).forEach((e=>{e.reset()})),this.refetchQueries(s,a))))}cancelQueries(e,t,r){const[n,a={}]=q(e,t,r);void 0===a.revert&&(a.revert=!0);const o=re.batch((()=>this.queryCache.findAll(n).map((e=>e.cancel(a)))));return Promise.all(o).then(j).catch(j)}invalidateQueries(e,t,r){const[n,a]=q(e,t,r);return re.batch((()=>{var e,t;if(this.queryCache.findAll(n).forEach((e=>{e.invalidate()})),"none"===n.refetchType)return Promise.resolve();const r={...n,type:null!=(e=null!=(t=n.refetchType)?t:n.type)?e:"active"};return this.refetchQueries(r,a)}))}refetchQueries(e,t,r){const[n,a]=q(e,t,r),o=re.batch((()=>this.queryCache.findAll(n).filter((e=>!e.isDisabled())).map((e=>{var t;return e.fetch(void 0,{...a,cancelRefetch:null==(t=null==a?void 0:a.cancelRefetch)||t,meta:{refetchPage:n.refetchPage}})}))));let s=Promise.all(o).then(j);return null!=a&&a.throwOnError||(s=s.catch(j)),s}fetchQuery(e,t,r){const n=F(e,t,r),a=this.defaultQueryOptions(n);void 0===a.retry&&(a.retry=!1);const o=this.queryCache.build(this,a);return o.isStaleByTime(a.staleTime)?o.fetch(a):Promise.resolve(o.state.data)}prefetchQuery(e,t,r){return this.fetchQuery(e,t,r).then(j).catch(j)}fetchInfiniteQuery(e,t,r){const n=F(e,t,r);return n.behavior={onFetch:e=>{e.fetchFn=()=>{var t,r,n,a,o,s;const i=null==(t=e.fetchOptions)||null==(r=t.meta)?void 0:r.refetchPage,u=null==(n=e.fetchOptions)||null==(a=n.meta)?void 0:a.fetchMore,c=null==u?void 0:u.pageParam,l="forward"===(null==u?void 0:u.direction),h="backward"===(null==u?void 0:u.direction),d=(null==(o=e.state.data)?void 0:o.pages)||[],f=(null==(s=e.state.data)?void 0:s.pageParams)||[];let g=f,p=!1;const m=e.options.queryFn||(()=>Promise.reject("Missing queryFn for queryKey '"+e.options.queryHash+"'")),v=(e,t,r,n)=>(g=n?[t,...g]:[...g,t],n?[r,...e]:[...e,r]),A=(t,r,n,a)=>{if(p)return Promise.reject("Cancelled");if(void 0===n&&!r&&t.length)return Promise.resolve(t);const o={queryKey:e.queryKey,pageParam:n,meta:e.options.meta};var s;s=o,Object.defineProperty(s,"signal",{enumerable:!0,get:()=>{var t,r;return null!=(t=e.signal)&&t.aborted?p=!0:null==(r=e.signal)||r.addEventListener("abort",(()=>{p=!0})),e.signal}});const i=m(o);return Promise.resolve(i).then((e=>v(t,n,e,a)))};let b;if(d.length)if(l){const t=void 0!==c,r=t?c:ve(e.options,d);b=A(d,t,r)}else if(h){const t=void 0!==c,r=t?c:(y=e.options,w=d,null==y.getPreviousPageParam?void 0:y.getPreviousPageParam(w[0],w));b=A(d,t,r,!0)}else{g=[];const t=void 0===e.options.getNextPageParam;b=i&&d[0]&&!i(d[0],0,d)?Promise.resolve(v([],f[0],d[0])):A([],t,f[0]);for(let r=1;r<d.length;r++)b=b.then((n=>{if(!i||!d[r]||i(d[r],r,d)){const a=t?f[r]:ve(e.options,n);return A(n,t,a)}return Promise.resolve(v(n,f[r],d[r]))}))}else b=A([]);var y,w;return b.then((e=>({pages:e,pageParams:g})))}}},this.fetchQuery(n)}prefetchInfiniteQuery(e,t,r){return this.fetchInfiniteQuery(e,t,r).then(j).catch(j)}resumePausedMutations(){return this.mutationCache.resumePausedMutations()}getQueryCache(){return this.queryCache}getMutationCache(){return this.mutationCache}getLogger(){return this.logger}getDefaultOptions(){return this.defaultOptions}setDefaultOptions(e){this.defaultOptions=e}setQueryDefaults(e,t){const r=this.queryDefaults.find((t=>K(e)===K(t.queryKey)));r?r.defaultOptions=t:this.queryDefaults.push({queryKey:e,defaultOptions:t})}getQueryDefaults(e){if(!e)return;const t=this.queryDefaults.find((t=>Q(e,t.queryKey)));return null==t?void 0:t.defaultOptions}setMutationDefaults(e,t){const r=this.mutationDefaults.find((t=>K(e)===K(t.mutationKey)));r?r.defaultOptions=t:this.mutationDefaults.push({mutationKey:e,defaultOptions:t})}getMutationDefaults(e){if(!e)return;const t=this.mutationDefaults.find((t=>Q(e,t.mutationKey)));return null==t?void 0:t.defaultOptions}defaultQueryOptions(e){if(null!=e&&e._defaulted)return e;const t={...this.defaultOptions.queries,...this.getQueryDefaults(null==e?void 0:e.queryKey),...e,_defaulted:!0};return!t.queryHash&&t.queryKey&&(t.queryHash=V(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.useErrorBoundary&&(t.useErrorBoundary=!!t.suspense),t}defaultMutationOptions(e){return null!=e&&e._defaulted?e:{...this.defaultOptions.mutations,...this.getMutationDefaults(null==e?void 0:e.mutationKey),...e,_defaulted:!0}}clear(){this.queryCache.clear(),this.mutationCache.clear()}}({defaultOptions:{queries:{staleTime:5e3,refetchOnWindowFocus:!1,networkMode:"always"}}}),ye=L(),we=void 0,xe={5:2e3,4:4e3,3:8e3,2:16e3,1:32e3},Oe="https://cashback-api-staging.operacdn.com/api/public/v8",_e="https://cashback-api-production.operacdn.com/api/public/v8",Ee=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Se=!1,Te=function(e){var t;return{avgPaymentTime:e.others.avgPaymentTime,avgTransactionRecognitionTime:0,cashbackTerms:e.texts.cashbackTerms,categories:e.others.categories||[],disableAssistant:e.others.disableBadge,categoryRates:(null===(t=e.rates)||void 0===t?void 0:t.categoryRates)||[],domains:e.basic.domains||[],isFeatured:e.others.isFeatured,maxCashbackNormal:e.others.maxCashbackNormal,previousMaxCashbackNormal:e.others.previousMaxCashbackNormal,floatRateNormal:e.others.floatRateNormal,merchantLogoUrl:e.basic.merchantLogoUrl,merchantLogoId:e.basic.merchantLogoId,merchantName:e.texts.merchantName,merchantId:e.basic.merchantId,offerCountry:e.targeting.countries.toString(),offerId:e.offerId,offerLongDesc:e.texts.offerLongDesc,priority:e.targeting.priority,searchPhrase:e.texts.searchPhrase,showAsAction:e.others.showAsAction,socialProof:e.others.socialProof,validToTimestamp:e.others.validToTimestamp,activationAvailableThroughTheSiteOnly:void 0!==e.others.activationAvailableThroughTheSiteOnly&&e.others.activationAvailableThroughTheSiteOnly,activeIconVisitingShopSite:void 0===e.others.activeIconVisitingShopSite||e.others.activeIconVisitingShopSite,allowedSubdomains:void 0===e.others.allowedSubdomains?[]:e.others.allowedSubdomains,forbiddenSubdomains:void 0===e.others.forbiddenSubdomains?[]:e.others.forbiddenSubdomains,showInShopList:void 0===e.others.showInShopList||e.others.showInShopList,showPopupActivateCb:void 0===e.others.showPopupActivateCb||e.others.showPopupActivateCb,showPopupCbActivated:void 0===e.others.showPopupCbActivated||e.others.showPopupCbActivated}},Pe=function(){var e=t(s().mark((function e(){var r,n,a,o=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>0&&void 0!==o[0]?o[0]:5,e.next=3,i.browser.storage.local.get(["country","language"]).then((function(e){return n=e.country,a=e.language}));case 3:if(!Ae){e.next=7;break}return e.abrupt("return",Ae);case 7:return Ae=fetch("".concat(Se?Oe:_e,"/offers?size=2000&country=").concat(n,"&lang=").concat(a,"&source=ext.").concat(ye)).then((function(e){return e.json()})).then((function(e){Ae=null;var t=e.content;return we=t.map((function(e){return Te(e)}))})).catch(function(){var e=t(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Error fetching data: ",t),!(r>0)){e.next=8;break}return e.next=4,Ee(xe[r]);case 4:return Ae=null,e.abrupt("return",Pe(r-1));case 8:return e.abrupt("return",we||[]);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",Ae);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=function(){var e=t(s().mark((function e(){var t,r=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>1&&void 0!==r[1]&&r[1],Se=r.length>0&&void 0!==r[0]&&r[0],void 0!==we&&!t){e.next=6;break}return e.next=6,Pe();case 6:return e.abrupt("return",we);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ke=function(){var e=t(s().mark((function e(){var t,r=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],e.abrupt("return",i.browser.storage.local.get("userId").then((function(e){return t||!e.userId?i.browser.cookies.get({url:l(),name:"__Secure-cuid"}).then((function(e){return null==e?void 0:e.value})):e.userId})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ce=function(){var e=t(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.browser.cookies.get({url:l(),name:"_country"}).then((function(e){return null==e?void 0:e.value})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Le=function(){var e=t(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.browser.cookies.get({url:l(),name:"csrftoken"}).then((function(e){return null==e?void 0:e.value})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ne=function(){var e=t(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.fetchQuery({queryKey:["saving-goals","fetch"],queryFn:function(){return fetch("".concat(l(),"api/cashback/v4/saving-goals/latest")).then((function(e){return e.json()})).catch((function(){return null}))}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ge=function(){var e=t(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.fetchQuery({staleTime:36e5,cacheTime:36e5,queryKey:["saving-goals","balance","get"],queryFn:function(){return fetch("".concat(l(),"api/cashback/v4/saving-goals/balances")).then((function(e){return e.json()})).catch((function(){return{pendingAmountBalance:{monetaryBalance:{amount:0,currency:null}},availableAmountBalance:{monetaryBalance:{amount:0,currency:null}},totalBalance:{monetaryBalance:{amount:0,currency:null}}}}))}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Re=function(){var e=t(s().mark((function e(t,r,n,a,o){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=fetch,e.t1="".concat(l(),"api/cashback/v4/saving-goals"),e.t2=JSON.stringify({imageId:a,monetaryAmount:{amount:r,currency:n},name:t,templateId:o}),e.next=5,Le();case 5:return e.t3=e.sent,e.t4={"X-CSRFToken":e.t3},e.t5={method:"POST",body:e.t2,headers:e.t4},e.next=10,(0,e.t0)(e.t1,e.t5).finally((function(){be.invalidateQueries({queryKey:["saving-goals","fetch"]})}));case 10:case"end":return e.stop()}}),e)})));return function(t,r,n,a,o){return e.apply(this,arguments)}}(),De=function(){var e=t(s().mark((function e(t,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.fetchQuery({queryKey:["saving-goals","templates","get"],queryFn:function(){return fetch("".concat(l(),"api/cashback/saving-goal-templates?currency=").concat(t,"&lang=").concat(r)).then((function(e){return e.json()})).catch((function(){return[]}))}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Me=function(){var e=t(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=fetch,e.t1="".concat(l(),"api/cashback/v4/saving-goals/latest"),e.t2=JSON.stringify({status:t}),e.next=5,Le();case 5:return e.t3=e.sent,e.t4={"X-CSRFToken":e.t3},e.t5={method:"PATCH",body:e.t2,headers:e.t4},e.next=10,(0,e.t0)(e.t1,e.t5).finally((function(){be.invalidateQueries({queryKey:["saving-goals","fetch"]})}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),je=function(){var e=t(s().mark((function e(){var t,r,n=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],r=n.length>1?n[1]:void 0,e.next=4,be.fetchQuery({queryKey:["popups","get"],queryFn:function(){return fetch("".concat(t?Oe:_e,"/popups?country=").concat(r.toUpperCase())).then((function(e){return e.json()})).catch((function(){return[]}))}});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();setInterval(Pe,144e5);const Fe=36e5,qe=36e5;var Ue;i.browser.storage.local.get().then((function(e){(Ue=e.uniqueID)||(Ue=(1e7.toString()+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(+e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+e/4).toString(16)})),i.browser.storage.local.set({uniqueID:Ue}),Be({category:"impression",action:"assistant_installed"}),!P&&!I&&i.browser.tabs.create({url:"".concat(l(),"?extensionInstalled=1&cid=").concat(encodeURIComponent(Ue))}))}));var Be=function(e){var t=e.category,r=e.action,n=e.label,a=e.value,o=e.badge_state,s=chrome.runtime.getManifest().version,i={name:r,params:Object.fromEntries(Object.entries({category:t,label:n,value:a,version:s,engagement_time_msec:1}).filter((function(e){return void 0!==e[1]})))},u=JSON.stringify({client_id:Ue,events:[i]});if(fetch("https://www.google-analytics.com/mp/collect?measurement_id=".concat("G-504Y0HBTWD","&api_secret=").concat("_reSGQFbQ0SmEwlLmJfnNg"),{method:"POST",body:u}),null!=T&&T.statsPrivate){var c=JSON.stringify({action:r.replace(/ |\(|\)/g,"_"),details:{source:"assistant",version:s,category:t,label:n,value:a,badge_state:o}});console.log("%c Reporting stats: feature_events.event_cashback ".concat(c),"color: #88f"),T.statsPrivate.recordSessionEvent("feature_events.event_cashback",c,T.statsPrivate.Priority.NORMAL)}};function Ve(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ke(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ve(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Qe=["google.com","facebook.com","instagram.com","twitter.com","whatsapp.com","tiktok.com","reddit.com","linkedin.com","vk.com","discord.com","messenger.com","telegram.org","tumblr.com","slack.com"],He=new Date("9 Dec 2023 0:0:0 GMT+1"),We=new Date("11 Dec 2023 23:59:59 GMT+1"),$e=new Date("16 Dec 2023 0:0:0 GMT+1"),Ye=new Date("18 Dec 2023 23:59:59 GMT+1"),Xe=function(){var e=Date.now();return e>Number(He)&&e<Number(We)},ze=function(e){var t,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(!r||function(e){return Qe.reduce((function(t,r){return t&&-1===e.host.indexOf(r)}),!0)}(r))&&e!==p.OperaGX&&(Xe()&&1!==n.counter1||(t=Date.now())>Number($e)&&t<Number(Ye)&&1!==n.counter2)};const Je={defaultMerge:Symbol("deepmerge-ts: default merge"),skip:Symbol("deepmerge-ts: skip")};function Ze(e,t){return t}function et(e){return"object"!=typeof e||null===e?0:Array.isArray(e)?2:function(e){if(!rt.has(Object.prototype.toString.call(e)))return!1;const{constructor:t}=e;if(void 0===t)return!0;const r=t.prototype;return!(null===r||"object"!=typeof r||!rt.has(Object.prototype.toString.call(r)))&&!!r.hasOwnProperty("isPrototypeOf")}(e)?1:e instanceof Set?3:e instanceof Map?4:5}function tt(e){return{*[Symbol.iterator](){for(const t of e)for(const e of t)yield e}}}Je.defaultMerge;const rt=new Set(["[object Object]","[object Module]"]);function nt(e){return e.at(-1)}var at,ot,st,it,ut,ct,lt,ht,dt,ft,gt,pt,mt,vt,At,bt,yt=Object.freeze({__proto__:null,mergeArrays:function(e){return e.flat()},mergeMaps:function(e){return new Map(tt(e))},mergeOthers:nt,mergeRecords:function(e,t,r){const n={};for(const s of function(e){const t=new Set;for(const r of e)for(const e of[...Object.keys(r),...Object.getOwnPropertySymbols(r)])t.add(e);return t}(e)){const i=[];for(const t of e)o=s,"object"==typeof(a=t)&&Object.prototype.propertyIsEnumerable.call(a,o)&&i.push(t[s]);if(0===i.length)continue;const u=t.metaDataUpdater(r,{key:s,parents:e}),c=xt(i,t,u);c!==Je.skip&&("__proto__"===s?Object.defineProperty(n,s,{value:c,configurable:!0,enumerable:!0,writable:!0}):n[s]=c)}var a,o;return n},mergeSets:function(e){return new Set(tt(e))}});function wt(...e){return function(e,t){const r=function(e,t){return{defaultMergeFunctions:yt,mergeFunctions:{...yt,...Object.fromEntries(Object.entries(e).filter((([e,t])=>Object.hasOwn(yt,e))).map((([e,t])=>!1===t?[e,nt]:[e,t])))},metaDataUpdater:e.metaDataUpdater??Ze,deepmerge:t,useImplicitDefaultMerging:e.enableImplicitDefaultMerging??!1,actions:Je}}({},n);function n(...e){return xt(e,r,undefined)}return n}()(...e)}function xt(e,t,r){if(0===e.length)return;if(1===e.length)return Ot(e,t,r);const n=et(e[0]);if(0!==n&&5!==n)for(let a=1;a<e.length;a++)if(et(e[a])!==n)return Ot(e,t,r);switch(n){case 1:return function(e,t,r){const n=t.mergeFunctions.mergeRecords(e,t,r);return n===Je.defaultMerge||t.useImplicitDefaultMerging&&void 0===n&&t.mergeFunctions.mergeRecords!==t.defaultMergeFunctions.mergeRecords?t.defaultMergeFunctions.mergeRecords(e,t,r):n}(e,t,r);case 2:return function(e,t,r){const n=t.mergeFunctions.mergeArrays(e,t,r);return n===Je.defaultMerge||t.useImplicitDefaultMerging&&void 0===n&&t.mergeFunctions.mergeArrays!==t.defaultMergeFunctions.mergeArrays?t.defaultMergeFunctions.mergeArrays(e):n}(e,t,r);case 3:return function(e,t,r){const n=t.mergeFunctions.mergeSets(e,t,r);return n===Je.defaultMerge||t.useImplicitDefaultMerging&&void 0===n&&t.mergeFunctions.mergeSets!==t.defaultMergeFunctions.mergeSets?t.defaultMergeFunctions.mergeSets(e):n}(e,t,r);case 4:return function(e,t,r){const n=t.mergeFunctions.mergeMaps(e,t,r);return n===Je.defaultMerge||t.useImplicitDefaultMerging&&void 0===n&&t.mergeFunctions.mergeMaps!==t.defaultMergeFunctions.mergeMaps?t.defaultMergeFunctions.mergeMaps(e):n}(e,t,r);default:return Ot(e,t,r)}}function Ot(e,t,r){const n=t.mergeFunctions.mergeOthers(e,t,r);return n===Je.defaultMerge||t.useImplicitDefaultMerging&&void 0===n&&t.mergeFunctions.mergeOthers!==t.defaultMergeFunctions.mergeOthers?t.defaultMergeFunctions.mergeOthers(e):n}function _t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Et(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_t(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var St,Tt,Pt,It,kt,Ct=function(e){return e.NEUTRAL="Neutral",e.AVAILABLE="Available",e.AVAILABLE_RED="Available_Red",e.AVAILABLE_YELLOW="Available_Yellow",e.ACTIVE="Active",e}(Ct||{}),Lt=(a(bt={},Ct.NEUTRAL,null===(at=window.opr)||void 0===at||null===(ot=at.cashbackPrivate)||void 0===ot||null===(st=ot.BadgeState)||void 0===st?void 0:st.DISABLED),a(bt,Ct.AVAILABLE,null===(it=window.opr)||void 0===it||null===(ut=it.cashbackPrivate)||void 0===ut||null===(ct=ut.BadgeState)||void 0===ct?void 0:ct.WARNING),a(bt,Ct.AVAILABLE_RED,null===(lt=window.opr)||void 0===lt||null===(ht=lt.cashbackPrivate)||void 0===ht||null===(dt=ht.BadgeState)||void 0===dt?void 0:dt.WARNING),a(bt,Ct.AVAILABLE_YELLOW,null===(ft=window.opr)||void 0===ft||null===(gt=ft.cashbackPrivate)||void 0===gt||null===(pt=gt.BadgeState)||void 0===pt?void 0:pt.IDLE),a(bt,Ct.ACTIVE,null===(mt=window.opr)||void 0===mt||null===(vt=mt.cashbackPrivate)||void 0===vt||null===(At=vt.BadgeState)||void 0===At?void 0:At.ACTIVE),bt),Nt={count:0,nextPopupNotBefore:0,nextPendingViewSection:0},Gt={automaticTimers:{welcome:0,competitor:0,notPartner:0,promos:{}},activationPopupCounter:0},Rt=!1,Dt={},Mt=!1,jt=!1,Ft=!1,qt=!1,Ut=function(){var e=t(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:je(c(),Tt).then((function(e){return It=e})).catch((function(){return It={checkout:[],competitor:[],notPartner:[]}}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Bt={},Vt={},Kt=function(e,t){var r=0;switch(e){case m.COMPETITOR:r=Gt.automaticTimers.competitor;break;case m.WELCOME:r=Gt.automaticTimers.welcome;break;case m.NOT_PARTNER:r=Gt.automaticTimers.notPartner;break;case m.PROMO:return ze(_(),Mt,t,Gt.automaticTimers.promos);default:return!0}return Date.now()>r},Qt=function(e){return e&&_()!==p.OperaGX},Ht=function(e){var t,r,n=!1;switch(e){case m.COMPETITOR:Gt.automaticTimers.competitor=Date.now()+864e5,n=!0;break;case m.WELCOME:Gt.automaticTimers.welcome=Date.now()+qe,n=!0;break;case m.NOT_PARTNER:Gt.automaticTimers.notPartner=Date.now()+qe,n=!0;break;case m.PROMO:Gt.automaticTimers.promos=Et({},(t=Gt.automaticTimers.promos,Ke(Ke(Ke({},{counter1:0,time1:-1,counter2:0,time2:-1}),t),(a(r={},"counter"+(Xe()?"1":"2"),1),a(r,"time"+(Xe()?"1":"2"),Date.now()),r)))),n=!0}return n&&i.browser.storage.local.set({popupsContext:Gt}),n},Wt=function(){var e,t=Date.now();e=function(e){return e.expire<t},Object.keys(Dt).forEach((function(t){e(Dt[t])&&delete Dt[t]}))},$t=function(){var e=t(s().mark((function e(t){var r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ie(c());case 2:return r=e.sent,n=(null==r?void 0:r.filter((function(e){return e.domains.map((function(r){return E(r,t,e.forbiddenSubdomains)})).reduce((function(e,t){return t||e}))})))||[],e.abrupt("return",{offers:n,allOffers:r,url:t});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Yt=function(){var e=t(s().mark((function e(t,r){var n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=["de","gb","us","es","mx","pl","br","ua"],a=["de","en","es","pl","pt","ru","uk"],P&&(r=i.browser.i18n.getUILanguage()),t=n.indexOf(t)>-1?t:"pl",r=a.indexOf(r)>-1?r:"en",Tt===t&&Pt===r){e.next=15;break}return Tt=t,Pt=r,i.browser.storage.local.set({country:Tt,language:Pt}),e.next=13,Ie(c(),!0);case 13:return e.next=15,Ut();case 15:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Xt=function(){var e=t(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(jt=t,e.t0=i.browser.storage.local,e.t1=jt,!t){e.next=9;break}return e.next=6,ke(!0);case 6:e.t2=e.sent,e.next=10;break;case 9:e.t2="";case 10:e.t3=e.t2,e.t4={isUserLogged:e.t1,userId:e.t3},e.t0.set.call(e.t0,e.t4),!Mt&&t&&(Mt=!0,i.browser.storage.local.set({isUserLoggedBefore:Mt}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),zt=function e(t,r){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;clearTimeout(kt);var c,l,h,d,f=-1===u;if(o?r=f&&(null===(c=Bt[t])||void 0===c?void 0:c.icon)||r:Bt[t]=Et(Et({},Bt[t]),{},{icon:r}),r===Ct.AVAILABLE&&(a.length&&(P&&a[0].disableAssistant||!P&&!a[0].activeIconVisitingShopSite)?r=Ct.NEUTRAL:jt&&!Rt?(u=10,r=Ct.AVAILABLE_RED):r=Ct.AVAILABLE_YELLOW),P)if(f&&r!==Ct.NEUTRAL&&!o&&Be({action:"badge_displayed",category:"impression",badge_state:Lt[r].toLowerCase()}),null!==(l=opr)&&void 0!==l&&null!==(h=l.cashbackPrivate)&&void 0!==h&&h.setTabState)null===(d=opr)||void 0===d||d.cashbackPrivate.setTabState(t,Lt[r]);else if(s){var g;null===(g=window.opr)||void 0===g||g.cashbackPrivate.setCashbackBadgeState(Number(s),Lt[r])}!P&&(null===(n=i.browser.pageAction)||void 0===n||n.setIcon({tabId:t,path:{32:"icons/32/Icon_".concat(C()?"Dark":"Light","_").concat(r,".png")}}).catch(console.log)),u>0&&(kt=setTimeout((function(){return e(t,r===Ct.AVAILABLE_RED?Ct.AVAILABLE_YELLOW:Ct.AVAILABLE_RED,a,o,s,u-1)}),350))},Jt=function(){var e=t(s().mark((function e(t,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.browser.tabs.executeScript(t,{code:'[\n        window.____dify_cashback_language="'.concat(Pt,'",\n        window.____dify_cashback_country="').concat(Tt,'",\n        window.____dify_cashback_injected_url,\n        window.____dify_cashback_injected_url="').concat(r.href,'"\n      ]')}).then((function(e){return e&&e[0]&&e[0][2]?{injected:e[0][2]===r.href,shouldSendStats:e[0][2]!==r.href,injectedAtLeastOnce:e[0][2]}:{injected:!1,shouldSendStats:!0,injectedAtLeastOnce:e[0][2]}})));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Zt=function(e,t,r){var n,a,o,s=!1,i=(n=It.checkout,a=t.merchantId,(null==n||null===(o=n.find((function(e){return e.merchantId===a})))||void 0===o?void 0:o.urls)||[]);return null==i||i.forEach((function(n){var a,o=new URL(n);o.host===e.host&&(o.pathname===e.pathname||""!==o.hash&&o.hash===e.hash||""!==o.search&&o.search===e.search)&&((null===(a=r[t.offerId])||void 0===a?void 0:a.checkout_shown_expire)+Fe||0)<Date.now()&&(r[t.offerId]=Et(Et({},r[t.offerId]),{},{checkout_shown_expire:Date.now()+Fe}),s=!0)})),s},er=function(e,t,r,n,a){var o=function(){zt(e,t?Ct.ACTIVE:Ct.AVAILABLE,r,n,a)};T&&T.cashbackPrivate&&!P?i.browser.tabs.query({active:!0}).then((function(t){var s=t.find((function(t){return t.id===e}));s&&T.cashbackPrivate.getCashbackBadgeState(s.windowId,(function(t){var s=!0;switch(t){case T.cashbackPrivate.BadgeState.IDLE:case T.cashbackPrivate.BadgeState.WARNING:s=!1;case T.cashbackPrivate.BadgeState.ACTIVE:zt(e,s?Ct.ACTIVE:Ct.AVAILABLE,r,n,a);break;case T.cashbackPrivate.BadgeState.DISABLED:o()}}))})):o()},tr=function(e,r){i.browser.tabs.query({}).then((function(n){var o=n.find((function(t){return t.id===e})),u=null==o?void 0:o.windowId;if(null!=o&&o.active)if(r&&r.startsWith("http")){var c=new URL(r);Jt(e,c).then((function(n){if(n.injected||delete Bt[e],c.hostname.indexOf("cashback.opera.com")>-1||c.hostname.indexOf("cashback.op-test.net")>-1||c.hostname.indexOf("localhost")>-1)n.injectedAtLeastOnce||i.browser.tabs.executeScript(e,{runAt:"document_end",file:"./content_getdify.js"}).catch(console.log),zt(e,Ct.NEUTRAL,[],!1,u);else{if(("us"===Tt||"ua"===Tt)&&!Mt)return void zt(e,Ct.NEUTRAL,[],!1,u);$t(r).then(function(){var o=t(s().mark((function t(o){var l,h,d,f,g,v,A,b,y,w,x,O;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l=o.offers,h=o.allOffers,Wt(),d=!l.length&&!Mt&&Kt(m.COMPETITOR,c)&&R(It.competitor,c)&&(_()!==p.OperaGX||["GB","ES"].indexOf(Tt.toUpperCase())>-1),Rt=!l.length&&Mt&&Kt(m.NOT_PARTNER,c)&&_()!==p.OperaGX&&D(It.notPartner,c).length>0,t.t0=u,!t.t0){t.next=9;break}return t.next=8,or(l,h,r,e,u.toString());case 8:t.t0=t.sent;case 9:if(f=t.t0,g=!1,v=d?m.COMPETITOR:Rt?m.NOT_PARTNER:l.length?Mt?m.ACTIVATION:m.WELCOME:null,!(l.length||d||Rt)){t.next=29;break}if(A=!1,jt&&l.forEach((function(e){var t=Dt[e.offerId];t&&t.expire>Date.now()&&(A=!0)})),er(e,A,l,n.injected,u),n.injected){t.next=27;break}if(!P){t.next=26;break}if(b=Mt&&!A&&l.reduce((function(e,t){return e||Zt(c,t,Dt)}),!1),v=b?m.CHECKOUT:v,!S(null==f?void 0:f.data,Tt,b)||!Kt(v,c)){t.next=24;break}return g=!0,t.next=24,ir(u,!1,v);case 24:t.next=27;break;case 26:i.browser.tabs.executeScript(e,{runAt:"document_start",file:"./content.js"}).catch(console.log);case 27:t.next=30;break;case 29:zt(e,Ct.NEUTRAL,[],n.injected,u);case 30:if(g||!P||n.injected||!Kt(m.PROMO,c)){t.next=36;break}return zt(e,Ct.AVAILABLE,[],(null===(y=Bt[e])||void 0===y?void 0:y.icon)!==Ct.NEUTRAL,u),v=m.PROMO,g=!0,t.next=36,ir(u,!1,v);case 36:n.shouldSendStats&&v&&g&&(a(w={},m.PROMO,"".concat("christmas_2023_"+(Xe()?1:2),"_visited")),a(w,m.COMPETITOR,"competitor_page_visited"),a(w,m.NOT_PARTNER,"non_partner_page_visited"),a(w,m.CHECKOUT,"checkout_page_visited"),a(w,m.WELCOME,"welcome_page_visited"),a(w,m.ACTIVATION,"supported_page_visited"),x=w,O=c.host.split(".").splice(c.host.startsWith("www.")?1:0).join("."),Be({action:x[v],category:"impression",label:O}));case 37:case"end":return t.stop()}}),t)})));return function(e){return o.apply(this,arguments)}}())}})).catch((function(t){console.log("Trouble: ",t),zt(e,Ct.NEUTRAL,[],!1,u)}))}else zt(e,Ct.NEUTRAL,[],!1,u)}))},rr=function(e,t){console.log("Sending message: ",e),void 0!==t?i.browser.tabs.sendMessage(t,e).catch(console.log):i.browser.runtime.sendMessage(e).catch(console.log)},nr=function(e){return(Dt[e.offerId]||{expire:0}).expire},ar=function(e,t){void 0!==e?i.browser.tabs.get(e).then((function(t){$t(t.url).then((function(t){var r=t.offers,n=t.allOffers,a=t.url;sr(r,a,n||[],e)}))})):N(Number(t)).then((function(e){e&&$t(e.url).then((function(t){var r=t.offers,n=t.allOffers,a=t.url;sr(r,a,n||[],e.id,e.windowId.toString())}))}))},or=function(){var e=t(s().mark((function e(t,r,n){var a,o,i,u,l,h,d,f,g,p,v,b,y,w,x,O,E,S,T,P,I,k,L,N,G=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x=G.length>3&&void 0!==G[3]?G[3]:void 0,O=G.length>4&&void 0!==G[4]?G[4]:void 0,E=t.length&&t.sort((function(e,t){return nr(e)<nr(t)?1:-1})).find((function(e){return Dt[e.offerId]})),S=x&&Vt[x]?Vt[x].urls:[],T=!1,!Qt(jt)){e.next=10;break}return e.next=8,Ge();case 8:P=e.sent,T=!!((null===(I=P)||void 0===I||null===(k=I.totalBalance)||void 0===k||null===(L=k.monetaryBalance)||void 0===L?void 0:L.amount)>0)||Gt.activationPopupCounter>3;case 10:return N={type:A.OFFER_DATA,data:{offer:t.length&&t[0],allOffers:r,browser:_(),theme:C()?"dark":"light",activated:Object.assign({expire:0,closed_till:0,tabId:x,domains:[n]},E&&Dt[E.offerId]),settingsForPage:Object.assign({dont_open_again:!1,dont_open_again_today:0,dont_open_all_shops:Ft,disable_saving_goals:qt},t.length&&St[t[0].offerId]),isActivated:jt&&!!E&&Dt[E.offerId].expire>Date.now(),url:n,staging:c(),redirs:S,isUserLogged:jt,isUserLoggedBefore:Mt,manualPopup:null===(a=Bt[x])||void 0===a?void 0:a.isManualPopup,notPartnerMerchantIds:(null===(o=Bt[x])||void 0===o?void 0:o.popup_type)===m.NOT_PARTNER&&D(It.notPartner,new URL(n)),popup_type:null===(i=Bt[x])||void 0===i?void 0:i.popup_type,windowId:O,savingGoalsEnabled:T,savingGoalsBalance:Object.assign(P?{total:(null===(u=P)||void 0===u||null===(l=u.totalBalance.monetaryBalance)||void 0===l?void 0:l.amount)||0,available:(null===(h=P)||void 0===h||null===(d=h.availableAmountBalance)||void 0===d||null===(f=d.monetaryBalance)||void 0===f?void 0:f.amount)||0,pending:(null===(g=P)||void 0===g||null===(p=g.pendingAmountBalance)||void 0===p||null===(v=p.monetaryBalance)||void 0===v?void 0:v.amount)||0,currency:null===(b=P)||void 0===b||null===(y=b.totalBalance)||void 0===y||null===(w=y.monetaryBalance)||void 0===w?void 0:w.currency}:{}),savingGoalsPopups:Nt}},t.length&&Mt&&(Dt[t[0].offerId]=Et(Et({},Dt[t[0].offerId]||{}),{},{closed_till:Date.now()+36e5})),e.abrupt("return",N);case 13:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),sr=function(){var e=t(s().mark((function e(t,r,n){var a,o,i=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>3&&void 0!==i[3]?i[3]:void 0,o=i.length>4&&void 0!==i[4]?i[4]:void 0,e.t0=rr,e.next=5,or(t,n,r,a,o);case 5:e.t1=e.sent,e.t2=o?void 0:a,(0,e.t0)(e.t1,e.t2);case 8:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),ir=function(){var e=t(s().mark((function e(t){var r,n,a,o,i=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(i.length>1&&void 0!==i[1])||i[1],a=i.length>2?i[2]:void 0,e.next=4,N(t);case 4:o=e.sent,a=a||(null===(r=Bt[o.id])||void 0===r?void 0:r.popup_type)||m.MAIN_NON_AUTOMATIC,Bt[o.id]=Et(Et({},Bt[o.id]),{},{popup_type:a,isManualPopup:n}),n||Ht(a),opr.cashbackPrivate.showPopup(t,Mt?40:280);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ur=function(){Be({category:"impression",action:"popup_closed"})},cr=function(e,t){Ie(c()).then((function(r){var n,a=null==r?void 0:r.find((function(t){return t.offerId===e}));((null===(n=Dt[e])||void 0===n?void 0:n.expire)||0)<Date.now()&&(Gt.activationPopupCounter++,i.browser.storage.local.set({popupsContext:Gt})),Dt[e]=Et(Et({},Dt[e]||{}),{},{expire:Date.now()+36e5,domains:null==a?void 0:a.domains,tabId:t,closed_till:void 0})}))},lr=function(e){delete Dt[e]},hr=function(){var e=t(s().mark((function e(){var r,n,a,o,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Tt){e.next=16;break}return e.next=3,Ce();case 3:if(e.t0=e.sent,e.t0){e.next=11;break}if(e.t1=P,!e.t1){e.next=10;break}return e.next=9,new Promise((function(e){opr.cashbackPrivate.getCountry(e)}));case 9:e.t1=e.sent.toLowerCase();case 10:e.t0=e.t1;case 11:return h=e.t0,e.next=14,Yt(h);case 14:e.next=18;break;case 16:return e.next=18,Yt(Tt,Pt);case 18:return e.next=20,Ie(c());case 20:return e.next=22,Ut();case 22:i.browser.runtime.onMessage.addListener(function(){var e=t(s().mark((function e(t,r){var n,a,o,c,l,h,d,f,g,p,m,b;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Received message: ",t),e.t0=t.type,e.next=e.t0===A.FETCH_OFFER_DATA?4:e.t0===A.SET_STAGING?6:e.t0===A.ACTIVATE_CASHBACK?10:e.t0===A.GET_SETTINGS_FOR_PAGE?12:e.t0===A.SET_SETTINGS_FOR_PAGE?14:e.t0===A.IS_LOGGED?37:e.t0===A.SEND_STATS?39:e.t0===A.GET_VERSION?41:e.t0===A.SET_LANGUAGE?43:e.t0===A.GET_SAVING_GOAL_DATA?46:e.t0===A.GET_SAVING_GOAL_TEMPLATES?48:e.t0===A.SET_SAVING_GOAL?65:e.t0===A.UPDATE_SAVING_GOAL?69:e.t0===A.RESET_SAVING_GOAL_COUNTER?71:e.t0===A.INCREASE_SAVING_GOAL_COUNTER?75:e.t0===A.MARK_PENDING_VIEW_SECTION?79:e.t0===A.RESET_STORAGE?82:85;break;case 4:return ar(null===(n=r.tab)||void 0===n?void 0:n.id,null===(a=t.data)||void 0===a?void 0:a.windowId),e.abrupt("break",85);case 6:return y=t.data.value,u=y,i.browser.storage.local.set({staging:y}),be.invalidateQueries({queryKey:["saving-goals"]}),location.reload(),e.abrupt("break",85);case 10:return cr(t.data.offerId,null===(o=r.tab)||void 0===o?void 0:o.id),e.abrupt("break",85);case 12:return rr({type:A.SETTINGS_FOR_PAGE,data:Object.assign({dont_open_again:!1,dont_open_again_today:0,dont_open_all_shops:Ft,disable_saving_goals:qt},St[t.data.offerId])},null===(c=r.tab)||void 0===c?void 0:c.id),e.abrupt("break",85);case 14:(g=t.data).offerId&&(St[g.offerId]=St[g.offerId]||{}),e.t1=s().keys(g);case 17:if((e.t2=e.t1()).done){e.next=34;break}p=e.t2.value,e.t3=p,e.next=e.t3===v.DONT_OPEN_AGAIN_TODAY?22:e.t3===v.DONT_OPEN_AGAIN?24:e.t3===v.DONT_OPEN_ALL_SHOPS?26:e.t3===v.DISABLE_SAVING_GOALS?29:32;break;case 22:return St[g.offerId][p]=(g.dont_open_again_today||0)>0?Date.now()+864e5:void 0,e.abrupt("break",32);case 24:return St[g.offerId][p]=g[p],e.abrupt("break",32);case 26:return Ft=!!g[p],i.browser.storage.local.set({disableAllPopups:Ft}),e.abrupt("break",32);case 29:return qt=!!g[p],i.browser.storage.local.set({disableSavingGoals:qt}),e.abrupt("break",32);case 32:e.next=17;break;case 34:return i.browser.storage.local.set({pageSettings:St}),ar(null===(l=r.tab)||void 0===l?void 0:l.id,g.windowId),e.abrupt("break",85);case 37:return Xt(!!t.data.logged),e.abrupt("break",85);case 39:return Be(Et({},t.data)),e.abrupt("break",85);case 41:return rr({type:A.VERSION,data:{version:L()}},null===(h=r.tab)||void 0===h?void 0:h.id),e.abrupt("break",85);case 43:return m=t.data,Yt(m.country,m.language),e.abrupt("break",85);case 46:return Ne().then((function(e){var t,n,a;rr({type:A.SAVING_GOAL_DATA,data:{imageId:null==e?void 0:e.imageId,imageUrl:null==e?void 0:e.imageUrl,templateId:null==e?void 0:e.templateId,amount:null==e||null===(t=e.monetaryAmount)||void 0===t?void 0:t.amount,currency:null==e||null===(n=e.monetaryAmount)||void 0===n?void 0:n.currency,name:null==e?void 0:e.name,status:null==e?void 0:e.status}},null===(a=r.tab)||void 0===a?void 0:a.id)})),e.abrupt("break",85);case 48:return e.next=50,Ge();case 50:if(e.t6=d=e.sent,e.t5=null===e.t6,e.t5){e.next=54;break}e.t5=void 0===d;case 54:if(!e.t5){e.next=58;break}e.t7=void 0,e.next=59;break;case 58:e.t7=null===(f=d.totalBalance.monetaryBalance)||void 0===f?void 0:f.currency;case 59:if(e.t4=e.t7,e.t4){e.next=62;break}e.t4="USD";case 62:return b=e.t4,De(b,Pt).then((function(e){var t;rr({type:A.SAVING_GOAL_TEMPLATES,data:((null==e?void 0:e.content)||[]).map((function(e){return{imageId:e.imageId,imageUrl:e.imageUrl,templateId:e.templateId,name:e.name,amount:e.price.amount,currency:e.price.currency}}))},null===(t=r.tab)||void 0===t?void 0:t.id)})),e.abrupt("break",85);case 65:return Re(t.data.name,t.data.amount,t.data.currency,t.data.imageId,t.data.templateId),Nt={count:0,nextPopupNotBefore:0,nextPendingViewSection:0},i.browser.storage.local.set({savingGoalsPopups:Nt}),e.abrupt("break",85);case 69:return Me(t.data),e.abrupt("break",85);case 71:return Nt.count=0,Nt.nextPopupNotBefore=0,i.browser.storage.local.set({savingGoalsPopups:Nt}),e.abrupt("break",85);case 75:return Nt.count++,Nt.nextPopupNotBefore=Date.now()+864e5,i.browser.storage.local.set({savingGoalsPopups:Nt}),e.abrupt("break",85);case 79:return Nt.nextPendingViewSection=Date.now()+864e5,i.browser.storage.local.set({savingGoalsPopups:Nt}),e.abrupt("break",85);case 82:return i.browser.storage.local.clear(),location.reload(),e.abrupt("break",85);case 85:case"end":return e.stop()}var y}),e)})));return function(t,r){return e.apply(this,arguments)}}()),i.browser.tabs.onCreated.addListener((function(e){var t;e.id&&(!P&&(null===(t=i.browser.pageAction)||void 0===t||t.show(e.id)),tr(e.id,e.url))})),P&&(null===(r=window.opr.cashbackPrivate)||void 0===r||null===(n=r.onCashbackButtonPressed)||void 0===n||n.addListener(ir)),P&&(null===(a=window.opr.cashbackPrivate)||void 0===a||null===(o=a.onCashbackPopupClosed)||void 0===o||o.addListener(ur)),i.browser.tabs.onUpdated.addListener((function(e,t,r){var n;!P&&(null===(n=i.browser.pageAction)||void 0===n||n.show(e)),tr(e,r.url)})),i.browser.tabs.onActivated.addListener((function(e){var t;!P&&(null===(t=i.browser.pageAction)||void 0===t||t.show(e.tabId)),i.browser.tabs.get(e.tabId).then((function(t){tr(e.tabId,t.url)}))})),!P&&i.browser.runtime.setUninstallURL("".concat(l(),"?extensionUninstalled=1&cid=").concat(encodeURIComponent(Ue))),i.browser.tabs.query({}).then((function(e){P||e.forEach((function(e){var t;return null===(t=i.browser.pageAction)||void 0===t?void 0:t.show(e.id)}))})),i.browser.webRequest.onHeadersReceived.addListener((function(e){if(Vt[e.tabId]&&Vt[e.tabId].requestId===e.requestId){Vt[e.tabId].urls.push(e.url);var t=new URL(Vt[e.tabId].urls[0]),r=new URL(e.url),n=t.searchParams.get("offerId"),a=l();0===a.indexOf(t.origin)&&0!==a.indexOf(r.origin)&&n&&cr(n)}else Vt[e.tabId]={urls:[e.url],requestId:e.requestId};Vt[e.tabId].urls.forEach((function(e){k(new URL(e))&&$t(e).then((function(e){e.offers.forEach((function(e){return lr(e.offerId)}))}))}))}),{urls:["<all_urls>"],types:["main_frame"]}),i.browser.webRequest.onBeforeSendHeaders.addListener((function(e){return e.requestHeaders.push({name:"Referer",value:l()}),{requestHeaders:e.requestHeaders}}),{urls:["https://cashback.opera.com/api/cashback/*","https://cashback.op-test.net/api/cashback/*"]},["blocking","requestHeaders","extraHeaders"]);case 32:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();console.log("%c --- Cashback Assistant ver: "+L()+" ----","color: #0f0"),!P&&I?(Be({category:"issue",action:"assistant_launched_without_cashback_flag"}),i.browser.tabs.query({url:"*://cashback.opera.com/*?extensionInstalled*"}).then((function(e){return null==e?void 0:e.forEach((function(e){return i.browser.tabs.remove(e.id)}))}))):i.browser.storage.local.get().then(function(){var e=t(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(St=t.pageSettings||{},jt=t.isUserLogged||jt,Mt=t.isUserLoggedBefore||Mt,Ft=t.disableAllPopups||Ft,qt=t.disableSavingGoals||qt,Nt=wt(Nt,t.savingGoalsPopups||{}),Gt=wt(Gt,t.popupsContext||{}),Tt=t.country,Pt=t.language,r=-1===Object.keys(t).indexOf("userId"),Mt&&!r){e.next=16;break}return e.t0=Xt,e.next=14,ke(!0);case 14:e.t1=!!e.sent,(0,e.t0)(e.t1);case 16:return e.next=18,new Promise((function(e){var t,r;T&&null!==(t=window.opr)&&void 0!==t&&null!==(r=t.operaBrowserPrivate)&&void 0!==r&&r.getProduct?opr.operaBrowserPrivate.getProduct((function(t){x="Opera GX"===t,e(!0)})):e(!0)})).finally((function(){O=!0}));case 18:hr();case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})()})();